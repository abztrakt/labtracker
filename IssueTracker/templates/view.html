{% extends "base_full.html" %}
{% load issue_extras %}
{% block pageCSS %}@import url('{{MEDIA_URL}}css/IssueTracker/view.css');{% endblock %}
{% block pageHead %}<script type="text/javascript" src="{{MEDIA_URL}}js/IssueTracker/view.js"></script>
<script type="text/javascript" src="{{MEDIA_URL}}js/prob_types.js"></script>
{% endblock %}

{% block heading %}Viewing Issue{% endblock %}
{% block content %}
<div id="main_issue">
<div id="issue">
	<h2 id="title">{{ issue.pk }} - {{ issue.title|escape }}</h2>

	<div id="problems">
		<h3 class='label'>Problems: </h3>
		{%  if issue.problem_type.all %}
		<ul class="struct inline">
			{% for issue in issue.problem_type.all %}
				<li>{{ issue }}</li>
			{% endfor %}
		</ul>
		{% else %}
		--
		{% endif %}
		<br class="clear" />
	</div>
    	
	<h3 class='label'>Description:</h3>
	<p id="description">{{ issue.description|escape }}</p>
    
</div>

{% for post in comments %}
<div id='post_{{ post.pk }}' class='comment'>
	<div class='post_date'>{{ post.time|date }} at {{ post.time|time }} by {{ post.user }}</div>
	<p>
		{{ post.comment|escape }}
	</p>
</div>
{% endfor %}

<form id='post_comment' method='post' action='{% url IssueTracker-view issue.pk %}'>
	<fieldset>
	<!-- add_comment_form, update_issue_form -->
	<ul class="struct">
		<li>
			<label for='id_assignee'>Assign To:</label>
			{{ update_issue_form.assignee }}
		</li>
		<li>
			<label for='id_resolved_state'>Resolve:</label> 
			{{ update_issue_form.resolved_state }}
		</li>
	</ul>
	<div class="left">
		<div>
			<label for='id_comment' style='display: block;'>
				{{ add_comment_form.comment.label }}
			</label>
			{{ add_comment_form.comment }}
		</div>
		<div class="none_if_js">
			{{ update_issue_form.problem_type }}
		</div>
	</div>
	<div class="left" id="itemUpdate">
		{% if extra_form %}{{ extra_form.as_p }}{% endif %}
	</div>
	<br class="clear" />

	{# {% include "IssueTracker/issue/prob_tag_block.html" %} #}
	<div id="prob-type-block">
		<label for="{{update_issue_form.problem_type.name}}">
			{{ update_issue_form.problem_type.label }}
		</label>
		<div>{{ update_issue_form.problem_type }}</div>
		<br class="clear" />
	</div>

	{% if comment_errors %}{{ comment_errors }}{% endif %}

	<br class="clear" />
	<input type="submit" name="submit" value="Submit" />
	</fieldset>
</form>
<br class="clear" />


</div>

<!-- Right side bar -->
<div id="right_side_bar">
    <div class="info">
        <ul class="struct">
			<li>
				<h4>Reporter:</h4><br />
				{{ issue.reporter }}
			</li>
			<li>
				<h4>Time Posted:</h4><br /> 
				{{ issue.post_time|date }} at {{ issue.post_time|time }}
			</li>
		</ul>
    </div>  

    <div class="info">
        <ul class="struct">
            <li class="clear"><h4>Inventory Type:</h4><br />  {{ issue.it }}</li>
			<li><h4>Group:</h4><br />  {{ issue.group }}</li>
			<li><h4>Item:</h4><br />  
				{% if issue.item %}
					<a href="{{ issue.item.item.get_absolute_url }}">
						{{ issue.item }}
					</a>
				{% else %}
					{{ issue.item }}
				{% endif %}
            </li>
			<li><h4>Assigned to:</h4><br />  {{ issue.assignee }}</li>
			<li><h4>State:</h4><br />  {{ issue.resolved_state }}</li>
			<li><h4>Contacts:</h4> {% contact issue %}</li>
        </ul>
	</div>

	<div class="info" id="specInfo">
		{% invspec issue %}
	</div>

	<!-- Stuff involving the CC list -->
	{% include "IssueTracker/cc_list.html" %}

	<div id="history_box">
		{% include "IssueTracker/issue/history.html" %}
	</div>
</div>
<br class='clear' />


{% endblock %}
